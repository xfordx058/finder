<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ü•§ Milk Tea Finder</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* --- CSS Variables and Global Reset --- */
      :root {
        --primary-color: #795548; /* Brown/boba color */
        --accent-color: #ffc107; /* Milk Tea/Cream color */
        --text-color: #333;
        --light-bg: #f5f5f5;
        --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      html,
      body {
        height: 100%;
        margin: 0;
        font-family: 'Poppins', sans-serif; /* Modern, readable font */
        color: var(--text-color);
        overflow: hidden; /* Prevent body scroll, map handles it */
      }

      /* --- Header/Title Bar --- */
      #header {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 60px;
        background-color: var(--primary-color);
        color: white;
        display: flex;
        align-items: center;
        padding: 0 20px;
        z-index: 10; /* Above the map */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      #header h1 {
        margin: 0;
        font-size: 1.5rem;
        font-weight: 700;
      }

      /* --- Map Container --- */
      #map {
        /* Take up full height, allowing for the header */
        height: calc(100% - 60px); 
        width: 100%;
        margin-top: 60px; /* Push map below the header */
      }

      /* --- Control Panel (Button) --- */
      #panel {
        position: absolute;
        bottom: 20px; /* Position at the bottom */
        left: 50%; /* Center horizontally */
        transform: translateX(-50%);
        background: rgba(255, 255, 255, 0.95); /* Slightly translucent white backdrop */
        padding: 15px;
        border-radius: 12px;
        box-shadow: var(--shadow-light);
        z-index: 5; /* Above the map, below the header */
        text-align: center;
        max-width: 90%; /* For mobile responsiveness */
      }

      /* --- Button Style --- */
      .btn {
        background: var(--primary-color);
        color: var(--accent-color); /* Milk Tea yellow accent on text */
        border: none;
        padding: 12px 25px; /* Larger padding */
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.1rem;
        font-weight: 600;
        letter-spacing: 0.5px;
        transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
        box-shadow: 0 4px 0 var(--primary-color); /* Simple 3D effect */
      }

      .btn:hover {
        background: #5d4037; /* Darker brown on hover */
        box-shadow: 0 2px 0 #5d4037;
        transform: translateY(2px); /* Button press effect */
      }

      .btn:active {
        background: #5d4037;
        box-shadow: none;
        transform: translateY(4px);
      }

      /* --- Google Maps Info Window Customization (Basic) --- */
      .gm-style .gm-style-iw-d {
        font-family: 'Poppins', sans-serif;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div id="header">
      <h1>ü•§ Milk Tea Finder</h1>
    </div>

    <div id="map"></div>

    <div id="panel">
      <button class="btn" onclick="findMilkTea()">üìç Find Milk Tea Near Me</button>
    </div>

    <script>
      let map, service, infoWindow;
      const DEFAULT_CENTER = { lat: 14.5995, lng: 120.9842 }; // Manila default

      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: DEFAULT_CENTER,
          zoom: 14,
          // Optional: Add a custom map style for a cleaner look
          // styles: [
          //   { featureType: 'poi', elementType: 'labels', stylers: [{ visibility: 'off' }] }
          // ]
        });
        infoWindow = new google.maps.InfoWindow();
        // Automatically try to find milk tea on load (optional)
        // findMilkTea(); 
      }

      function findMilkTea() {
        // 1. Clear previous markers (optional, but good practice)
        clearMarkers(); 

        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              const userLocation = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
              };

              map.setCenter(userLocation);
              map.setZoom(15); // Zoom in closer after finding location

              // User location marker
              new google.maps.Marker({
                position: userLocation,
                map: map,
                title: 'You are here',
                icon: {
                  url: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png', // Clearer user marker
                  scaledSize: new google.maps.Size(40, 40),
                },
              });

              const request = {
                location: userLocation,
                radius: 3000, // Increased to 3km for better results
                keyword: 'milk tea',
              };

              service = new google.maps.places.PlacesService(map);
              service.nearbySearch(request, (results, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK && results) {
                  for (let place of results) {
                    createMarker(place);
                  }
                  if (results.length === 0) {
                      alert('No Milk Tea spots found within 3km. Try another location!');
                  }
                } else if (status === google.maps.places.PlacesServiceStatus.ZERO_RESULTS) {
                    alert('No Milk Tea spots found within 3km. Try another location!');
                } else {
                    console.error('Places service failed:', status);
                }
              });
            },
            (error) => {
              // Geolocation error handler
              let errorMessage = 'Geolocation error: ';
              switch (error.code) {
                case error.PERMISSION_DENIED:
                  errorMessage += 'User denied the request for Geolocation.';
                  break;
                case error.POSITION_UNAVAILABLE:
                  errorMessage += 'Location information is unavailable.';
                  break;
                case error.TIMEOUT:
                  errorMessage += 'The request to get user location timed out.';
                  break;
                case error.UNKNOWN_ERROR:
                  errorMessage += 'An unknown error occurred.';
                  break;
              }
              alert(errorMessage);
              map.setCenter(DEFAULT_CENTER); // Fallback to default
            }
          );
        } else {
          alert('Geolocation not supported by this browser.');
        }
      }

      // Array to store markers for clearing them later
      let markers = []; 

      function createMarker(place) {
        if (!place.geometry || !place.geometry.location) return;
        
        // Custom boba-like marker icon
        const bobaIcon = {
            url: "data:image/svg+xml;charset=UTF-8,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='12' cy='12' r='10' fill='%23795548'/%3E%3Ccircle cx='12' cy='12' r='4' fill='%23FFC107'/%3E%3Cpath d='M10 14L14 10' stroke='white' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E",
            scaledSize: new google.maps.Size(35, 35),
            anchor: new google.maps.Point(17, 35)
        };

        const marker = new google.maps.Marker({
          map,
          position: place.geometry.location,
          title: place.name,
          icon: bobaIcon,
        });

        markers.push(marker); // Store the marker

        google.maps.event.addListener(marker, 'click', () => {
          infoWindow.setContent(`
            <div style="padding: 5px;">
                <strong style="font-size: 16px; color: var(--primary-color);">${place.name}</strong>
                <br>
                ${place.vicinity || ''}
                ${place.rating ? `<br>Rating: ${place.rating} ‚≠ê` : ''}
            </div>
          `);
          infoWindow.open(map, marker);
        });
      }
      
      function clearMarkers() {
          for (let i = 0; i < markers.length; i++) {
              markers[i].setMap(null);
          }
          markers = [];
      }
    </script>

    <script
      async
      src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY_HERE&libraries=places&callback=initMap"
    ></script>
  </body>
</html>
