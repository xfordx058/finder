<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MilkTea Finder (Google Maps)</title>
    <style>
      html, body { height: 100%; margin: 0; font-family: Arial, sans-serif; }
      #map { height: 100%; width: 100%; }
      #panel {
        position: absolute;
        top: 10px; left: 10px;
        background: white; padding: 10px;
        border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      }
      .btn { background: #d6336c; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; }
    </style>
  </head>
  <body>
    <div id="panel">
      <button class="btn" onclick="findMilkTea()">üìç Find Milk Tea Near Me</button>
    </div>
    <div id="map"></div>

    <script>
      let map, service, infoWindow;

      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 14.5995, lng: 120.9842 }, // Manila default
          zoom: 14,
        });
        infoWindow = new google.maps.InfoWindow();
      }

      function findMilkTea() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition((position) => {
            const userLocation = {
              lat: position.coords.latitude,
              lng: position.coords.longitude,
            };
            map.setCenter(userLocation);

            new google.maps.Marker({
              position: userLocation,
              map: map,
              title: "You are here",
              icon: "https://maps.google.com/mapfiles/ms/icons/blue-dot.png"
            });

            const request = {
              location: userLocation,
              radius: 2000, // 2km
              keyword: "milk tea",
            };

            service = new google.maps.places.PlacesService(map);
            service.nearbySearch(request, (results, status) => {
              if (status === google.maps.places.PlacesServiceStatus.OK) {
                for (let place of results) {
                  createMarker(place);
                }
              }
            });
          });
        } else {
          alert("Geolocation not supported.");
        }
      }

      function createMarker(place) {
        if (!place.geometry || !place.geometry.location) return;
        const marker = new google.maps.Marker({
          map,
          position: place.geometry.location,
        });
        google.maps.event.addListener(marker, "click", () => {
          infoWindow.setContent(`<strong>${place.name}</strong><br>${place.vicinity || ''}`);
          infoWindow.open(map, marker);
        });
      }
    </script>

    <!-- Replace YOUR_API_KEY_HERE with your actual key -->
    <script async
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDk8cpELLpGngE-1uLEGSuG5VnUwTqPq3w&libraries=places&callback=initMap">
    </script>
  </body>
</html>
